<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Permissions  - Mobile Applications for Engineers</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../.././theme/pagetoc.css">
        <link rel="stylesheet" href="../.././theme/css/mdbook-admonish.css">
        <link rel="stylesheet" href="../.././theme/css/code.css">
        <link rel="stylesheet" href="../.././theme/css/terminal.css">
        <link rel="stylesheet" href="../.././theme/css/output.css">
        <link rel="stylesheet" href="../.././theme/css/film.css">
        <link rel="stylesheet" href="../.././theme/css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="dracula">Dracula</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frappé</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="kanagawa">Knagawa</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="pinkrose">Pinkrose</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="tender">Tender</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="tokyonight">Tokyonight</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mobile Applications for Engineers</h1>

                    <div class="right-buttons">
                        <a href="https://github.com/uniofgreenwich/ELEE1146-COMP1836_Exercises" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/uniofgreenwich/ELEE1146-COMP1836_Exercises/edit/main/content/Kotlin/Lab_9/Lab_9.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main><div class="sidetoc"><nav class="pagetoc"></nav></div>
                        <h1 id="lab-9-permissions"><a class="header" href="#lab-9-permissions">Lab 9: Permissions</a></h1>
<h2 id="what-are-android-runtime-permissions"><a class="header" href="#what-are-android-runtime-permissions">What are Android Runtime Permissions?</a></h2>
<p>With the introduction of Android 6.0 (SDK 23), users are prompted for some specific permissions at runtime when they become necessary to use.</p>
<details id="admonition-will-the-older-apps-run-on-android-marshmallow" class="admonition admonish-question" role="note" aria-labelledby="admonition-will-the-older-apps-run-on-android-marshmallow-title">
<summary class="admonition-title">
<div id="admonition-will-the-older-apps-run-on-android-marshmallow-title">
<p>Will the older apps run on Android Marshmallow?</p>
</div>
<a class="admonition-anchor-link" href="#admonition-will-the-older-apps-run-on-android-marshmallow"></a>
</summary>
<div>
<ul>
<li>
<p>If the targetSdkVersion is 22 or less.</p>
</li>
<li>
<p>Thus android runtime permissions support backward compatibility.</p>
</li>
<li>
<p>Now this doesn’t mean that you can work with old model of permissions by setting the sdk version to 22.</p>
</li>
</ul>
</div>
</details>
<hr />
<p>A user using Marshmallow can revoke the dangerous permissions (we’ll discuss the dangerous and normal permissions later) from the Settings-&gt;Apps-&gt;Permissions.</p>
<p>In the case we try to call some function that requires a permission which user has not granted yet, the function will suddenly throw an Exception(<code>java.lang.SecurityException</code>) that will lead to the application crashing.</p>
<p>Hence you need to implement this new android permissions model in the below application.</p>
<h2 id="dangerous-and-normal-android-permissions"><a class="header" href="#dangerous-and-normal-android-permissions">Dangerous and Normal android permissions</a></h2>
<p>Android defines some permissions as dangerous and some as normal.</p>
<p>The common thing in both the types is that they need to be defined in the Manifest file.</p>
<p>From Android 6.0 only dangerous permissions are checked at runtime, normal permissions are not. An example of a normal permission is <code>android.permission.INTERNET</code>.</p>
<p>Dangerous permissions are grouped into categories that make it easier for the user to understand what they are allowing the application to do. If the user accepts one permission in a group/category they accept the entire group. An example of dangerous permission is <code>android.permission.FINE_LOCATION</code> and <code>android.permission.COARSE_LOCATION</code>.</p>
<p>Enabling anyone of the location permissions enables all.</p>
<p>Now you are going to develop an application which checks if the permission is already present. If not, then it’s requested at runtime.</p>
<hr />
<h2 id="build"><a class="header" href="#build">Build</a></h2>
<ol>
<li>Create application with at least API 28 selected.</li>
<li>Name it <code>permissions</code></li>
<li>Open the <code>MainActivity.kt</code> and reproduce the following code:</li>
</ol>
<hr />
<h2 id="mainfest-file"><a class="header" href="#mainfest-file">Mainfest File</a></h2>
<ol>
<li>
<p>Open <code>AndroidMainfest.xml</code></p>
</li>
<li>
<p>Add the following tags underneath the 4th line:</p>
 <div id="admonition-code" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-title">
 <div class="admonition-title">
 <div id="admonition-code-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code"></a>
 </div>
 <div>
<pre><code class="language-xml">    &lt;uses-permission android:name="android.permission.CAMERA" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" /&gt;
</code></pre>
 </div>
 </div>
</li>
</ol>
<hr />
<h2 id="mainactivitykt"><a class="header" href="#mainactivitykt"><code>MainActivity.kt</code></a></h2>
<ol>
<li>
<p>Open <code>MainActivity.kt</code></p>
</li>
<li>
<p>Implement the necessary imports at the top of the file.</p>
 <div id="admonition-code-1" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-1-title">
 <div class="admonition-title">
 <div id="admonition-code-1-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-1"></a>
 </div>
 <div>
<pre><code class="language-kt">package com.uog.permissions;

import android.Manifest
import android.content.pm.PackageManager
import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.rememberLauncherForActivityResult
import androidx.activity.compose.setContent
import androidx.activity.result.contract.ActivityResultContracts
import androidx.compose.foundation.layout.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.tooling.preview.Preview
import androidx.compose.ui.unit.dp
import androidx.core.content.ContextCompat
import com.uog.permissions.ui.theme.PermissionsTheme
</code></pre>
 </div>
 </div>
</li>
<li>
<p>See a few new lines within this code block you may not have seen before..</p>
<ul>
<li><code>import android.content.pm.PackageManager</code>
<ul>
<li>Class for retrieving various kinds of information related to the application packages that are currently installed on the device.</li>
<li>recommended to read the documentation here -&gt; <a href="https://stuff.mit.edu/afs/sipb/project/android/docs/reference/android/content/pm/PackageManager.html">https://stuff.mit.edu/afs/sipb/project/android/docs/reference/android/content/pm/PackageManager.html</a></li>
</ul>
</li>
<li><code>import android.Manifest</code>
<ul>
<li>So you can use the permissions stored in the <code>AndroidManifest.xml</code> file you will populate later.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Define variables for the UI components and override onCreate.</p>
 <div id="admonition-code-2" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-2-title">
 <div class="admonition-title">
 <div id="admonition-code-2-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-2"></a>
 </div>
 <div>
<pre><code class="language-kt">...
class MainActivity : ComponentActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            PermissionsTheme {
                PermissionsScreen()
            }
        }
    }
}
</code></pre>
 </div>
 </div>
</li>
</ol>
<hr />
<h2 id="implement-the-permissionsscreen"><a class="header" href="#implement-the-permissionsscreen">Implement the <code>PermissionsScreen</code></a></h2>
<table style="border-collapse: collapse; border: none;">
<tr style="border: none;">
<td style="border: none;">
<ol>
<li>We need to now replicate the screen on the right:
<ul>
<li>Within a Scaffold</li>
<li>Topbar
<ul>
<li>with the following colour 0xFF6A0DAD</li>
</ul>
</li>
<li>Two Buttons placed in a column with a Spacer between them
<ul>
<li>The buttons have the colour 0xFF6A0DAD</li>
</ul>
</li>
</ul>
</li>
</ol>
</td>
<td style="border: none;">
<div align=center>
<p><img src="./figures/step1.png" alt="" /></p>
</div>
</td>
</tr>
<tr style="border: none;">
<td style="border: none;" colspan=2>
<ol start="2">
<li><details id="admonition-code-here-if-you-are-struggling-46-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-here-if-you-are-struggling-46-lines-title">
<summary class="admonition-title">
<div id="admonition-code-here-if-you-are-struggling-46-lines-title">
<p>Code here if you are struggling ...[46 lines]:</p>
</div>
<a class="admonition-anchor-link" href="#admonition-code-here-if-you-are-struggling-46-lines"></a>
</summary>
<div>
<pre><code class="language-kt">@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun PermissionsScreen() {
    Scaffold(
        topBar = {
            TopAppBar(
                colors = TopAppBarDefaults.topAppBarColors(
                    containerColor = Color(0xFF6A0DAD),
                    titleContentColor = Color.White
                ),
                title = { Text("Permissions") }
            )
        },
        content = { paddingValues -&gt;
            Column(
                modifier = Modifier
                    .fillMaxSize()
                    .padding(paddingValues)
                    .padding(16.dp),
                verticalArrangement = Arrangement.Center,
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                Button(
                    onClick = { /* TODO: Add Action */ },
                    colors = ButtonDefaults.buttonColors(
                        containerColor = Color(0xFF6A0DAD),
                        contentColor = Color.White
                    )
                ) {
                    Text("Check Permission")
                }

                Spacer(modifier = Modifier.height(16.dp))

                Button(
                    onClick = { /* TODO: Add Action */ },
                    colors = ButtonDefaults.buttonColors(
                        containerColor = Color(0xFF6A0DAD),
                        contentColor = Color.White
                    )
                ) {
                    Text("Request Permission")
                }
            }
        }
    )
}
</code></pre>
</div>
</details>
</li>
</ol>
</td>
</tr>
</table>
<ol start="3">
<li>
<p>Now add two <code>var</code>iables at top of the function, that have presistence during composable calls called <code>showSnackbar</code> and <code>snackbarMessage</code></p>
 <details id="admonition-code-here-if-you-are-struggling-3-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-here-if-you-are-struggling-3-lines-title">
 <summary class="admonition-title">
 <div id="admonition-code-here-if-you-are-struggling-3-lines-title">
<p>Code here if you are struggling ...[3 lines]:</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-here-if-you-are-struggling-3-lines"></a>
 </summary>
 <div>
<pre><code class="language-kt">fun PermissionsScreen(){
    var snackbarMessage by remember { mutableStateOf("") }
    var showSnackbar by remember { mutableStateOf(false) }
...
}
</code></pre>
 </div>
 </details>
</li>
<li>
<p>Add an <code>if</code> for the <code>showSnackBar</code>, assume default value <code>true</code></p>
<ul>
<li>
<p>where the a <code>SnackBar</code> with a <code>Button</code> as a composable with the the <code>Text</code> "Dimiss"</p>
</li>
<li>
<p>The Button onclick should set <code>showSnackbar</code> to <code>false</code></p>
</li>
<li>
<p>a <code>Text</code> composable for the body of the <code>SnackBar</code> that takes the <code>snackBarMessage</code> variable as the input.</p>
  <details id="admonition-code-here-if-you-are-struggling-11-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-here-if-you-are-struggling-11-lines-title">
  <summary class="admonition-title">
  <div id="admonition-code-here-if-you-are-struggling-11-lines-title">
<p>Code here if you are struggling ...[11 lines]:</p>
  </div>
  <a class="admonition-anchor-link" href="#admonition-code-here-if-you-are-struggling-11-lines"></a>
  </summary>
  <div>
<pre><code class="language-kt">...
Button(){...}
if (showSnackbar) {
    Snackbar(
        action = {
            Button(onClick = { showSnackbar = false }) {
                Text("Dismiss")
            }
        }
    ) {
        Text(snackbarMessage)
    }
}
</code></pre>
  </div>
  </details>
</li>
</ul>
</li>
<li>
<p>Next we need to modify the <code>Buttons</code> <code>onclick</code> for <code>"Check Permission"</code> and <code>"Request Permission"</code> so that they set the snackBarMessage as <code>"Check Permission Clicked"</code> and <code>"Request Permission Clicked"</code>. Additionally the buttons should set the <code>showSnackbar</code> to <code>true</code> too.</p>
 <details id="admonition-code-here-if-you-are-struggling-21-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-here-if-you-are-struggling-21-lines-title">
 <summary class="admonition-title">
 <div id="admonition-code-here-if-you-are-struggling-21-lines-title">
<p>Code here if you are struggling ...[21 lines]:</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-here-if-you-are-struggling-21-lines"></a>
 </summary>
 <div>
<pre><code class="language-kt">...
Button(
    onClick = {
        snackbarMessage = "Check Permission clicked!"
        showSnackbar = true
    },
    colors = ButtonDefaults.buttonColors(
        containerColor = Color(0xFF6A0DAD),
        contentColor = Color.White
    )
) {
    Text("Check Permission")
}

...

Button(
    onClick = {
        snackbarMessage = "Request Permission clicked!"
        showSnackbar = true
    },
    colors = ButtonDefaults.buttonColors(
        containerColor = Color(0xFF6A0DAD),
        contentColor = Color.White
    )
) {
    Text("Request Permission")
}
</code></pre>
 </div>
 </details>
</li>
</ol>
<h2 id="adding-permission-handling"><a class="header" href="#adding-permission-handling">Adding Permission Handling</a></h2>
<p>Now, we will integrate permission handling using Jetpack Compose's support for the Activity Result API. This enables us to check and request permissions dynamically.</p>
<ol>
<li>A reminder from earlier Android Eco system requires users to explicitly grant permissions for certain app features, like accessing the camera or location. We'll use:</li>
</ol>
<ul>
<li><code>ACCESS_FINE_LOCATION</code>: For precise location access.
<ul>
<li><code>ACCESS_COARSE_LOCATION</code>: is required when using <code>ACCESS_FINE_LOCATION</code></li>
</ul>
</li>
<li><code>CAMERA</code>: For taking photos or scanning QR codes.</li>
</ul>
<ol start="2">
<li>
<p>To manage permissions dynamically, we use the <code>rememberLauncherForActivityResult</code> API. Add the following to the <code>PermissionsScreen()</code>:</p>
<ul>
<li>You need to place the following underneath the <code>showSnackbar by remember ...</code> line</li>
</ul>
 <div id="admonition-code-3" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-3-title">
 <div class="admonition-title">
 <div id="admonition-code-3-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-3"></a>
 </div>
 <div>
<pre><code class="language-kt">...
val context = LocalContext.current
val requestPermissionsLauncher = rememberLauncherForActivityResult()
...
</code></pre>
 </div>
 </div>
</li>
<li>
<p>Now we need to populate <code>rememberLauncherForActivityResult</code> to provide:</p>
<ul>
<li>A contract to define the action (e.g., requesting permissions).</li>
<li>A result handler to process the result.</li>
</ul>
 <div id="admonition-code-4" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-4-title">
 <div class="admonition-title">
 <div id="admonition-code-4-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-4"></a>
 </div>
 <div>
<pre><code class="language-kt">val requestPermissionsLauncher = rememberLauncherForActivityResult(
    contract = ActivityResultContracts.RequestMultiplePermissions(),
    onResult = { permissions -&gt; 
    }
)
</code></pre>
 </div>
 </div>
</li>
<li>
<p>We now need to check if each permission has been granted, after <code>permission -&gt;</code> lambda expression:</p>
 <div id="admonition-code-5" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-5-title">
 <div class="admonition-title">
 <div id="admonition-code-5-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-5"></a>
 </div>
 <div>
<pre><code class="language-kt">// Check if each permission is granted or denied
val locationPermissionGranted = permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true
val cameraPermissionGranted = permissions[Manifest.permission.CAMERA] == true
</code></pre>
 </div>
 </div>
</li>
<li>
<p>Lastly, within this function we need select <code>when</code> <code>locationPermissionGranted</code> &amp;&amp; <code>cameraPermissionGranted</code>, <code>locationPermissionGranted</code> only, <code>cameraPermissionGranted</code> only or no permissions have been granted. Whereby the <code>snackbarMessage</code> as a meaningful message</p>
<details id="admonition-code-here-if-you-are-struggling-16-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-here-if-you-are-struggling-16-lines-title">
<summary class="admonition-title">
<div id="admonition-code-here-if-you-are-struggling-16-lines-title">
<p>Code here if you are struggling ...[16 lines]:</p>
</div>
<a class="admonition-anchor-link" href="#admonition-code-here-if-you-are-struggling-16-lines"></a>
</summary>
<div>
<pre><code class="language-kt">...
// Provide feedback based on permission status
    when {
        locationPermissionGranted &amp;&amp; cameraPermissionGranted -&gt; {
            snackbarMessage = "Both permissions granted."
        }
        locationPermissionGranted -&gt; {
            snackbarMessage = "Location permission granted, but Camera permission denied."
        }
        cameraPermissionGranted -&gt; {
            snackbarMessage = "Camera permission granted, but Location permission denied."
        }
        else -&gt; {
            snackbarMessage = "Both permissions denied."
        }
    }
    showSnackbar = true
}
...
</code></pre>
</div>
</details>
</li>
</ol>
<hr />
<h2 id="checkpermissions"><a class="header" href="#checkpermissions"><code>checkPermissions()</code></a></h2>
<ol>
<li>
<p>You now need to create a function called <code>checkPermissions</code> that can be called by the <code>Button</code> <code>"Check Permissions"</code></p>
 <div id="admonition-code-6" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-6-title">
 <div class="admonition-title">
 <div id="admonition-code-6-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-6"></a>
 </div>
 <div>
<pre><code class="language-kt">// Check if permissions are granted
fun checkPermissions(context: android.content.Context): Boolean {
    val locationPermission = ContextCompat.checkSelfPermission(
        context, Manifest.permission.ACCESS_FINE_LOCATION
    )
    val cameraPermission = ContextCompat.checkSelfPermission(
        context, Manifest.permission.CAMERA
    )
    return locationPermission == PackageManager.PERMISSION_GRANTED &amp;&amp;
            cameraPermission == PackageManager.PERMISSION_GRANTED
}

</code></pre>
 </div>
 </div>
 <div id="admonition-explanation-of-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-explanation-of-code-title">
 <div class="admonition-title">
 <div id="admonition-explanation-of-code-title">
<p>Explanation of code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-explanation-of-code"></a>
 </div>
 <div>
<ul>
<li><code>ContextCompat.checkSelfPermission</code>: A convenience method for checking if a specific permission is granted.
<ul>
<li><strong>Parameters</strong>:</li>
<li><code>context</code>: The app's context, providing access to the permission system.</li>
<li><code>Manifest.permission.ACCESS_FINE_LOCATION</code>: The permission being checked.</li>
<li><strong>Return Value</strong>: An integer representing the permission status:</li>
<li><code>PackageManager.PERMISSION_GRANTED</code>: Indicates the permission is granted.</li>
<li><code>PackageManager.PERMISSION_DENIED</code>: Indicates the permission is denied.</li>
<li>The result is stored in <code>locationPermission</code></li>
</ul>
</li>
</ul>
 </div>
 </div>
</li>
</ol>
<hr />
<h2 id="involking-checkpermissions"><a class="header" href="#involking-checkpermissions">Involking <code>checkPermissions()</code></a></h2>
<ol>
<li>
<p>Update the the <code>"Check Permission"</code> <code>Button</code> to invoke the <code>checkPermissions</code> function:</p>
 <div id="admonition-code-7" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-7-title">
 <div class="admonition-title">
 <div id="admonition-code-7-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-7"></a>
 </div>
 <div>
<pre><code class="language-kt">onClick = {
    // Check if the permissions are already granted
    val permissionsGranted = checkPermissions(context)
    if (permissionsGranted) {
        snackbarMessage = "Permissions already granted."
    } else {
        snackbarMessage = "Please request permission."
    }
    showSnackbar = true
}
</code></pre>
 </div>
 </div>
</li>
<li>
<p>Update the <code>"Request Permissions"</code> <code>Button</code> to make use of <code>requestPermissionsLauncher.launch</code>:</p>
 <div id="admonition-code-8" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-8-title">
 <div class="admonition-title">
 <div id="admonition-code-8-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-8"></a>
 </div>
 <div>
<pre><code class="language-kt">onClick = {
    // Request permissions using the launcher
    requestPermissionsLauncher.launch(
        arrayOf(Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.CAMERA)
    )
}
</code></pre>
 </div>
 </div>
</li>
</ol>
<hr />
<h2 id="running-the-app"><a class="header" href="#running-the-app">Running the App</a></h2>
<ol>
<li>
<p>Build and run your app on an Android emulator or a physical Android device.</p>
</li>
<li>
<p>Click the "Check Permission" button to see if permissions are already granted.</p>
</li>
<li>
<p>Click the "Request Permission" button to request permissions if they are not granted.</p>
</li>
<li>
<p>Verify that the Snackbar messages are displayed appropriately based on permission status.</p>
</li>
</ol>
<table style="border-collapse: collapse; border: none; table-layout: fixed; width: 100%;" >
<tr style="border: none;">
<td style="border: none; width:33%;">
<p>Output shows All permissions granted.</p>
<img src="figures/Granted.gif">
</td>
<td style="border: none; width:33%;">
<p>Output shows one permission granted.</p>
<img src="figures/SemiGranted.gif">
</td>
<td style="border: none;width:33%;">
<p>You will need to reset the permission once permanently granted.</p>
<img src="figures/ResetPermissions.gif">
</td>
</tr>
</table>
<div align=center>
</div>
<hr />
<h2 id="full-code"><a class="header" href="#full-code">Full code</a></h2>
<details id="admonition-code-here159-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-here159-lines-title">
<summary class="admonition-title">
<div id="admonition-code-here159-lines-title">
<p>Code here...[159 lines]:</p>
</div>
<a class="admonition-anchor-link" href="#admonition-code-here159-lines"></a>
</summary>
<div>
<pre><code class="language-kt">package com.uog.permissions

import android.Manifest
import android.content.pm.PackageManager
import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.rememberLauncherForActivityResult
import androidx.activity.compose.setContent
import androidx.activity.result.contract.ActivityResultContracts
import androidx.compose.foundation.layout.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.tooling.preview.Preview
import androidx.compose.ui.unit.dp
import androidx.core.content.ContextCompat
import com.uog.permissions.ui.theme.PermissionsTheme

class MainActivity : ComponentActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            PermissionsTheme {
                PermissionsScreen()
            }
        }
    }
}

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun PermissionsScreen() {
    val context = LocalContext.current
    var snackbarMessage by remember { mutableStateOf("") }
    var showSnackbar by remember { mutableStateOf(false) }

    // Define the permission launcher using the new Activity Result API
    val requestPermissionsLauncher = rememberLauncherForActivityResult(
        contract = ActivityResultContracts.RequestMultiplePermissions(),
        onResult = { permissions -&gt;
            // Check if each permission is granted or denied
            val locationPermissionGranted = permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true
            val cameraPermissionGranted = permissions[Manifest.permission.CAMERA] == true

            // Provide feedback based on permission status
            when {
                locationPermissionGranted &amp;&amp; cameraPermissionGranted -&gt; {
                    snackbarMessage = "Both permissions granted."
                }
                locationPermissionGranted -&gt; {
                    snackbarMessage = "Location permission granted, but Camera permission denied."
                }
                cameraPermissionGranted -&gt; {
                    snackbarMessage = "Camera permission granted, but Location permission denied."
                }
                else -&gt; {
                    snackbarMessage = "Both permissions denied."
                }
            }
            showSnackbar = true
        }
    )

    Scaffold(
        topBar = {
            TopAppBar(
                colors = TopAppBarDefaults.topAppBarColors(
                    containerColor = Color(0xFF6A0DAD),
                    titleContentColor = Color.White
                ),
                title = { Text("Permissions") }
            )
        },
        content = { paddingValues -&gt;
            Column(
                modifier = Modifier
                    .fillMaxSize()
                    .padding(paddingValues)
                    .padding(16.dp),
                verticalArrangement = Arrangement.Center,
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                Button(
                    colors = ButtonDefaults.buttonColors(
                        containerColor = Color(0xFF6A0DAD),
                        contentColor = Color.White
                    ),
                    onClick = {
                        // Check if the permissions are already granted
                        val permissionsGranted = checkPermissions(context)
                        if (permissionsGranted) {
                            snackbarMessage = "Permissions already granted."
                        } else {
                            snackbarMessage = "Please request permission."
                        }
                        showSnackbar = true
                    }
                ) {
                    Text("Check Permission")
                }

                Spacer(modifier = Modifier.height(16.dp))

                Button(
                    colors = ButtonDefaults.buttonColors(
                        containerColor = Color(0xFF6A0DAD),
                        contentColor = Color.White
                    ),
                    onClick = {
                        // Request permissions using the launcher
                        requestPermissionsLauncher.launch(
                            arrayOf(Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.CAMERA)
                        )
                    }
                ) {
                    Text("Request Permission")
                }

                if (showSnackbar) {
                    Snackbar(
                        action = {
                            Button(onClick = { showSnackbar = false }) {
                                Text("Dismiss")
                            }
                        }
                    ) {
                        Text(snackbarMessage)
                    }
                }
            }
        }
    )
}

// Check if permissions are granted
fun checkPermissions(context: android.content.Context): Boolean {
    val locationPermission = ContextCompat.checkSelfPermission(
        context, Manifest.permission.ACCESS_FINE_LOCATION
    )
    val cameraPermission = ContextCompat.checkSelfPermission(
        context, Manifest.permission.CAMERA
    )
    return locationPermission == PackageManager.PERMISSION_GRANTED &amp;&amp;
            cameraPermission == PackageManager.PERMISSION_GRANTED
}

@Preview(showBackground = true)
@Composable
fun DefaultPreview() {
    PermissionsTheme {
        PermissionsScreen()
    }
}
</code></pre>
</div>
</details>
<h2 id="afterwards"><a class="header" href="#afterwards">Afterwards</a></h2>
<ol>
<li>
<p>Create functionality to revoke permissions whilst in the app.</p>
</li>
<li>
<p>Experiment with other permissions, add more buttons to check each permission</p>
<blockquote>
<ul>
<li><a href="https://gist.github.com/Arinerron/1bcaadc7b1cbeae77de0263f4e15156f">https://gist.github.com/Arinerron/1bcaadc7b1cbeae77de0263f4e15156f</a> and see what they mean.</li>
<li><a href="https://github.com/aosp-mirror/platform_frameworks_base/blob/master/core/res/AndroidManifest.xml#L833">https://github.com/aosp-mirror/platform_frameworks_base/blob/master/core/res/AndroidManifest.xml#L833</a><style>.scroll-to-top { font-size: 2.5rem; width: 3.2rem; height: 3.2rem; display: none; align-items: center; justify-content: center; position: fixed; padding: 0.75rem; bottom: 4rem; right: calc(1.25rem + 90px + var(--page-padding)); z-index: 999; cursor: pointer; border: none; color: var(--bg); background: var(--fg); border-radius: 50%; } .scroll-to-top.hidden { display: none; } .scroll-to-top i { transform: translateY(-2px); } @media (min-width: 1080px) { .scroll-to-top { display: flex; } }</style><button type="button" aria-label="scroll-to-top" class="scroll-to-top hidden" onclick="scrollToTop()"> <i class="fa fa-angle-up"></i></button><script>const scrollToTop = () =&gt; window.scroll({ top: 0, behavior: "smooth" }); window.addEventListener("scroll", () =&gt; { const button = document.querySelector(".scroll-to-top"); button.classList.toggle("hidden", window.scrollY &lt;200); });</script><style>footer { text-align: center; text-wrap: balance; margin-top: 5rem; display: flex; flex-direction: column; justify-content: center; align-items: center; } footer p { margin: 0; }</style><footer><p>Copyright © 2025 • Created with ❤️ by <a href="https://github.com/CompEng0001">CompEng0001</a></p></footer></li>
</ul>
</blockquote>
</li>
</ol>
<footer><span class="gitinfo-footer" style="font-size:0.8em;padding:4px;margin:0.5em 0;text-align:right;display:block;">Page last updated: Thursday 26 June 2025 @ 14:13:52 | Commit: 15c04c1</span></footer>
                    </main>
                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../Kotlin/Lab_8/Lab_8.1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../Kotlin/Lab_10/Lab_10.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../Kotlin/Lab_8/Lab_8.1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../Kotlin/Lab_10/Lab_10.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../.././theme/pagetoc.js"></script>
        <script src="../.././theme/highlightjs-line-numbers.js"></script>


    </div>
    </body>
</html>